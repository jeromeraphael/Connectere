<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test chat</title>
</head>
<body>
    <h1>Chat</h1>
    <div id="chat-container">
        <div id="chat-display-box"></div>
        <div id="chat-input-box">
            <form action="submit" id="msg-form">
                <input type="text" id="input" placeholder="Send Chat Message">
            </form>
        </div>
    </div>
    <script>
        let userId = 1
        let form = document.getElementById('msg-form'); 
        let chatDisplay = document.getElementById('chat-display-box'); 

        const getChatHistory = (relationship) => {
            fetch(`/${relationship}/chats`, {
                    credentials: 'same-origin', 
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(chats => chats.json())
                .then(chats => {
                    for (let i = 0; i < chats.length; i++) {
                        let messageDiv = document.createElement('div'); 
                        let message = document.createElement('span'); 
                        let sender = document.createElement('span'); 
                        sender.className = 'mesage-sender'; 
                        sender.textContent = chats[i]['Sender'] + ': '; 
                        messageDiv.appendChild(sender);
                        message.textContent = chats[i]['chatContent']; 
                        messageDiv.appendChild(message); 
                        chatDisplay.append(messageDiv); 
                    }
                }); 
        }

        const getRelationships = (userId) => {
            fetch(`/${userId}/relationships`, {
                    credentials: 'same-origin', 
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(relationships => relationships.json())
                .then(relationships => {
                    localStorage.setItem('relationships', relationships);
                    getChatHistory(relationships[0]); 
                }); 
        }

        getRelationships(userId); 

        form.addEventListener('submit', e => {
            e.preventDefault(); 
            let chatMessage = document.getElementById('input'); 
            if (input.value) {

                console.log(localStorage.getItem('relationships')); 
            }
        })
    </script>
</body>
</html>